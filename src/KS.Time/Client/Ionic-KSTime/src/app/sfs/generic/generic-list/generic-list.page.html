<ion-header  #header >
  <ion-grid class="ion-no-padding">
    <ion-row class="ion-no-padding">
      <ion-col size-md="12" class="ion-no-padding">

        <ion-toolbar [ngStyle]="{ 'display': showSearchBar ? 'none' : '' }">
          <ion-buttons slot="start" >
            <ion-menu-button *ngIf="isFormTabs == false"></ion-menu-button>
           
            <!-- <ion-back-button></ion-back-button> -->
            <ion-button *ngIf="isFormTabs" size="small" fill="clear" (click)="openMenu($event)">
              <ion-icon slot="icon-only" name="chevron-down">
      
              </ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title class="ion-text-left ion-no-padding" *ngIf="this.uiSettings.titlePlace == 1">
            {{title}}
    
          </ion-title>
          <ion-buttons slot="end">
            <ion-button size="small" (click)="showSearchBar = !showSearchBar">
              <ion-icon name="search-outline" slot="icon-only"></ion-icon>
            </ion-button>
            <ion-button size="small" *ngIf="isFormTabs == false">
              <ion-icon name="notifications-outline" slot="icon-only"></ion-icon>
            </ion-button>
            <ion-button size="small" (click)="showFilter()">
              <ion-icon name="options-outline" slot="icon-only"></ion-icon>
            </ion-button>
            <app-user-menu *ngIf="currentMediaQuery =='lg' || currentMediaQuery =='xl' || currentMediaQuery =='md' ">
            </app-user-menu>


          </ion-buttons>
        </ion-toolbar>
        <ion-searchbar placeholder="buscar" animated showCancelButton debounce="500" *ngIf="showSearchBar"
          (ionCancel)="handleCancelSearchbar($event)" (ionClear)="handleClearSearchbar($event)"
          (ionChange)="handleChangeSearchbar($event)">
        </ion-searchbar>

      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-progress-bar type="indeterminate" *ngIf="loadingData == true"></ion-progress-bar>
</ion-header>

<div class="filter-enabled" *ngIf="itemFilter != null">
  <ion-item class="ion-padding-start">
    <ion-label> Existe un filtro aplicado</ion-label>
    <div slot="end">
      <ion-button color="light" class=" ion-no-padding" (click)="showFilter()" Fill="clear" aria-label="Limpiar filtro" data-microtip-position="up"
      role="tooltip">

      <ion-icon slot="icon-only"  name="create-outline"></ion-icon>
     
    </ion-button>
      <ion-button class="remove-filter ion-no-padding" color="light" (click)="removeFilter()" Fill="clear" aria-label="Limpiar filtro" data-microtip-position="up"
                role="tooltip">
                <ion-icon slot="icon-only"  name="close-circle"></ion-icon>
               
              </ion-button>
    
  
    </div>
  </ion-item>
 
 
</div>
<ion-content padding class="page-list" #content scrollEvents="true" appHideHeader [header]="header">


  <ion-refresher *ngIf="currentMediaQuery =='xs' || currentMediaQuery =='sm'" slot="fixed"
    (ionRefresh)="doRefresh($event)">
    <ion-refresher-content pullingIcon="chevron-down-circle-outline" refreshingSpinner="circles">
    </ion-refresher-content>
  </ion-refresher>

  <!-- Desktop -->
  <ion-grid *ngIf="currentMediaQuery =='lg' || currentMediaQuery =='xl' || currentMediaQuery =='md'">
    <ion-row>
      <ion-col size="3" *ngIf="hideFilter == false">

        <ion-grid>
          <ion-row>
            <ion-col size="6" class="ion-text-left">
              <ion-button (click)="showFilter()" Fill="clear" aria-label="Filtro" data-microtip-position="up"
                role="tooltip">
                <ion-icon slot="icon-only" name="funnel"></ion-icon>
              </ion-button>

            </ion-col>

            <ion-col size="6" class="ion-text-right">

              <ion-button (click)="refreshFilter()" Fill="clear" aria-label="Limpiar filtro" data-microtip-position="up"
                role="tooltip">
                <ion-icon slot="icon-only" name="refresh"></ion-icon>
              </ion-button>
            </ion-col>
          </ion-row>

          <ion-row>

            <ion-col>

              <formly-form [form]="formFilter" [fields]="fields" [model]="itemFilter"></formly-form>

              <div class="ion-text-center buttons-filter">
                <ion-button (click)="refreshFilter()" size="small" class=" sfs-button secondary" fill="clear">
                  LIMPIAR
                </ion-button>
                <ion-button (click)="applyFilter()" size="small" class="sfs-button primary">
                  APLICAR
                </ion-button>


              </div>

            </ion-col>

          </ion-row>
        </ion-grid>

      </ion-col>
      <ion-col [size]="hideFilter == false ? '9' : '12'">





        <ion-grid>
          <ion-row>

            <ion-col class="ion-no-padding ion-text-left title"
              *ngIf="this.uiSettings.titlePlace == 2 || this.systemService.isDesktop()">
              <table>
                <tr>
                  <td *ngIf="hideFilter == true && fields != null && fields.length">
                    <ion-button (click)="showFilter()" Fill="clear">
                      <ion-icon slot="icon-only" name="funnel"></ion-icon>
                    </ion-button>
                  </td>

                  <td *ngIf="this.uiSettings.titlePlace == 2">

                    <h1>{{title}}</h1>
                  </td>
                </tr>
              </table>
            </ion-col>
            <ion-col class="ion-no-padding ion-text-right" *ngIf="this.uiSettings.addButtonPlace  == 3">

              <ion-button class="ion-align-self-end sfs-button danger" fill="outline" color="danger"
                (click)="delete(null)" *ngIf="selection.selected.length > 0">
                <!--<ion-icon slot="start" name="trash"></ion-icon>-->
                Eliminar seleccionados
              </ion-button>
              <ion-button *ngIf="canAdd == true && externalCustomFileChecked == true && uiSettings.addButtonPlace == 2"
                color="primary" class="ion-align-self-end sfs-button primary" (click)="addItem()">

                {{addNewTitle}}
              </ion-button>
            </ion-col>

          </ion-row>

          <ion-row>
            <ion-col class="">


              <ng-container *ngIf="currentMediaQuery =='lg' || currentMediaQuery =='xl' || currentMediaQuery =='md'">

                <sfs-table class="hidde-when-mobile" [data]="data" [columns]="tableColumns"
                  (onSortChange)="onSortChange($event)" [pagination]="pagination" [displayedColumns]="displayedColumns"
                  (onPageChange)="handlePageChange($event)">
                </sfs-table>

              </ng-container>






            </ion-col>
          </ion-row>
        </ion-grid>

      </ion-col>
    </ion-row>
  </ion-grid>



  <ng-template #HeaderCheckTemplate>
    <mat-checkbox aria-label="Select All" [checked]="isAllSelected()" [indeterminate]="indeterminate"
      (change)="masterToggle()">

    </mat-checkbox>
  </ng-template>


  <ng-template #Id let-value="value" let-row="row">
    <div>
      <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null"
        [checked]="selection.isSelected(row)" [aria-label]="checkboxLabel(row)"></mat-checkbox>
    </div>
  </ng-template>
  <ng-template #TitleCell let-value="value" let-row="row">
    <div class="navigation-cell" (click)="clickItem(row)">
      {{ row?.Title }}
    </div>
  </ng-template>
  <ng-template #UpdatedDateCell let-prop="prop" let-row="row">


    {{row?.UpdatedDate + "Z"| timeAgo}}
  </ng-template>
  <ng-template #actionsTmpl let-row="row" let-prop="prop">
    <button *ngIf="row['__actions'] != null" mat-button [matMenuTriggerFor]="beforeMenu">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #beforeMenu="matMenu" xPosition="before">
      <button mat-menu-item *ngFor="let act of row['_actions']" (click)="action(row,act.ActionKey)">
        <mat-icon>{{act.Icon}}</mat-icon> {{act.Text}}
      </button>

    </mat-menu>
  </ng-template>

  <!-- Mobile -->
  <ng-container *ngIf="currentMediaQuery =='xs' || currentMediaQuery =='sm' ">


    <mat-accordion *ngIf="bindedData == true && uiSettings.useMaterialExpansionPanel == true" class="accordion">
      <mat-expansion-panel [id]="item.Id" #expansionPanel (afterExpand)="scrollTo(content, item.Id, index)"
        *ngFor="let item of data; let odd = odd;let index = index;">
        <mat-expansion-panel-header class="mat-exp-list-head" (click)="expand(expansionPanel, $event, item)"
          [ngClass]="{'odd-item-list' : odd, 'item-list-expanded' : expansionPanel.expanded}">
          <mat-panel-title style="display: unset;">
            <ion-item-sliding>

              <ion-item lines="none" >
                <ion-avatar slot="start" *ngIf="item.__avatar != null">
                </ion-avatar>
                <ion-checkbox class="ion-margin-start" (ionChange)="$event ? checkboxChange(item) : null"
                  *ngIf="this.selection.isEmpty() == false" [(ngModel)]="item.__isChecked"></ion-checkbox>
              
                 
                      <ion-label  class="ion-margin-start " (click)="selectItem($event, item)"
                        (press)="longPress($event, item, 2)">
                        {{getItemPrimaryColumn(item)}}
                      </ion-label>
                 
                      
                      <div slot="end">
                        <ion-badge *ngIf="item.__visible == true" [color]="item.__elementcolor ? item.__elementcolor : 'primary'" >{{getItemValueColumn(item)}}</ion-badge>
                        
                      </div>
                  
              </ion-item>
              <ion-item-options side="start">
                <ion-item-option color="danger" (click)="delete(item)">
                  <ion-icon slot="icon-only" name="trash"></ion-icon>

                </ion-item-option>
                <ion-item-option color="success">

                  <ion-icon slot="icon-only" name="eye"></ion-icon>
                </ion-item-option>
              </ion-item-options>
            </ion-item-sliding>

          </mat-panel-title>
        </mat-expansion-panel-header>


        <div class="row-content" *ngFor="let prop of getItemColumnsForMobile(item)">
          <span class="label">{{prop.text}}</span>
          <span class="value">{{prop.value}}</span>
        </div>


        <!-- Acciones -->
        <div style="text-align: end;">
          <ion-button size="small" fill="clear"  (click)="openMassiveActions(item)">
            <ion-icon name="ellipsis-horizontal-circle" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-button  size="small" (tap)="selectItem($event, item)">
            Abrir
          </ion-button>

        </div>
      </mat-expansion-panel>
    </mat-accordion>


    <ion-list *ngIf="uiSettings.useMaterialExpansionPanel == false">

      <ion-item-sliding *ngFor="let item of data; let odd = odd;let index = index;">
        <ion-item [id]="item.Id" lines="none">
          <ion-avatar slot="start" *ngIf="item.__avatar != null">
          </ion-avatar>
          <ion-checkbox (ionChange)="$event ? selection.toggle(item) : null" *ngIf="this.selection.isEmpty() == false"
            [(ngModel)]="item.__isChecked"></ion-checkbox>

          <ion-label style="width: 100%">
            {{getPrimaryColumn(item)}}
          </ion-label>
        </ion-item>
        <ion-item-options side="start">
          <ion-item-option color="danger">trash</ion-item-option>
        </ion-item-options>
      </ion-item-sliding>

    </ion-list>
    <!-- Infinite Scroll -->
    <ion-infinite-scroll #infiniteScroll (ionInfinite)="handleInfiniteScroll(infiniteScroll, $event)">
      <ion-infinite-scroll-content></ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </ng-container>

  <ion-fab *ngIf="uiSettings.addButtonPlace == 1" vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="addItem()" ion-fab>
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

   
  
</ion-content>

<ion-footer *ngIf=" selection.isEmpty() == false && (currentMediaQuery =='xs' || currentMediaQuery =='sm') ">
  <ion-toolbar>
    <ion-buttons slot="start">
    <ion-button icon-start fill="clear">
      <ion-checkbox (ionChange)="$event ? selectAll() : null" [(ngModel)]="selectedAll"></ion-checkbox>
     
    </ion-button>
  <div>
    {{selection.selected.length}} Seleccionados
  </div>
  </ion-buttons>
   
   
 
    <ion-buttons slot="end">
      <ion-button icon-only  fill="clear" (click)="openMassiveActions()">
        <ion-icon color="danger" name="trash"></ion-icon>
      </ion-button>
    <ion-button icon-start  fill="clear" (click)="openMassiveActions()">
      <ion-icon name="ellipsis-horizontal-circle"></ion-icon> Acción
    </ion-button>
    </ion-buttons>
    

    <!-- <ion-button icon-start size="small">
      <ion-icon name="trash"></ion-icon> Eliminar
    </ion-button> -->

  </ion-toolbar>
</ion-footer>
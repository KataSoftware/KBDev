<ion-header>
  <ion-grid class="ion-no-padding">
    <ion-row class="ion-no-padding">
      <ion-col size-md="12" class="ion-no-padding">

        <ion-toolbar [ngStyle]="{ 'display': showSearchBar ? 'none' : '' }">
          <ion-buttons slot="start">
            <ion-menu-button></ion-menu-button>
            <ion-back-button></ion-back-button>
          </ion-buttons>
          <ion-title *ngIf="this.uiSettings.titlePlace == 1">
            {{title}}
          </ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="showSearchBar = !showSearchBar">
              <ion-icon name="search" slot="icon-only"></ion-icon>
            </ion-button>
            <app-user-menu *ngIf="currentMediaQuery =='lg' || currentMediaQuery =='xl' || currentMediaQuery =='md' ">
            </app-user-menu>


          </ion-buttons>
        </ion-toolbar>
        <ion-searchbar placeholder="buscar" animated showCancelButton debounce="500" *ngIf="showSearchBar"
          (ionCancel)="handleCancelSearchbar($event)" (ionClear)="handleClearSearchbar($event)"
          (ionChange)="handleChangeSearchbar($event)">
        </ion-searchbar>

      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-progress-bar type="indeterminate" *ngIf="loadingData == true"></ion-progress-bar>
</ion-header>

<ion-content padding class="page-list" #content>
  <ion-fab *ngIf="uiSettings.addButtonPlace == 1" vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="addItem()" ion-fab>
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>


<!-- Desktop -->
  <ion-grid>
    <ion-row>
      <ion-col size="3" *ngIf="hideFilter == false">

        <ion-grid>
          <ion-row>
            <ion-col size="6" class="ion-text-left">
              <ion-button (click)="showFilter()" Fill="clear" aria-label="Filtro" data-microtip-position="up"
                role="tooltip">
                <ion-icon slot="icon-only" name="funnel"></ion-icon>
              </ion-button>

            </ion-col>

            <ion-col size="6" class="ion-text-right">

              <ion-button (click)="refreshFilter()" Fill="clear" aria-label="Limpiar filtro" data-microtip-position="up"
                role="tooltip">
                <ion-icon slot="icon-only" name="refresh"></ion-icon>
              </ion-button>
            </ion-col>
          </ion-row>

          <ion-row>

            <ion-col>

              <formly-form [form]="formFilter" [fields]="fields" [model]="itemFilter"></formly-form>

              <div class="ion-text-center buttons-filter">
                <ion-button (click)="refreshFilter()" size="small" class=" sfs-button secondary" fill="clear">
                  LIMPIAR
                </ion-button>
                <ion-button (click)="applyFilter()" size="small" class="sfs-button primary">
                  APLICAR
                </ion-button>


              </div>

            </ion-col>

          </ion-row>
        </ion-grid>

      </ion-col>
      <ion-col [size]="hideFilter == false ? '9' : '12'">





        <ion-grid>
          <ion-row>

            <ion-col class="ion-no-padding ion-text-left title"
              *ngIf="this.uiSettings.titlePlace == 2 || this.systemService.isDesktop()">
              <table>
                <tr>
                  <td *ngIf="hideFilter == true && fields != null && fields.length">
                    <ion-button (click)="showFilter()" Fill="clear">
                      <ion-icon slot="icon-only" name="funnel"></ion-icon>
                    </ion-button>
                  </td>

                  <td *ngIf="this.uiSettings.titlePlace == 2">

                    <h1>{{title}}</h1>
                  </td>
                </tr>
              </table>
            </ion-col>
            <ion-col class="ion-no-padding ion-text-right" *ngIf="this.uiSettings.addButtonPlace  == 3">

              <ion-button class="ion-align-self-end sfs-button danger" fill="outline" color="danger"
                (click)="delete(null)" *ngIf="selection.selected.length > 0">
                <!--<ion-icon slot="start" name="trash"></ion-icon>-->
                Eliminar seleccionados
              </ion-button>
              <ion-button *ngIf="canAdd == true && externalCustomFileChecked == true && uiSettings.addButtonPlace == 2"
                color="primary" class="ion-align-self-end sfs-button primary" (click)="addItem()">

                {{addNewTitle}}
              </ion-button>
            </ion-col>

          </ion-row>

          <ion-row>
            <ion-col class="">


              <ng-container *ngIf="currentMediaQuery =='lg' || currentMediaQuery =='xl' || currentMediaQuery =='md'">

                <sfs-table class="hidde-when-mobile" [data]="data" [columns]="tableColumns"
                  (onSortChange)="onSortChange($event)" [pagination]="pagination" [displayedColumns]="displayedColumns"
                  (onPageChange)="handlePageChange($event)">
                </sfs-table>

              </ng-container>



             


            </ion-col>
          </ion-row>
        </ion-grid>

      </ion-col>
    </ion-row>
  </ion-grid>



  <ng-template #HeaderCheckTemplate>
    <mat-checkbox aria-label="Select All" [checked]="isAllSelected()" [indeterminate]="indeterminate"
      (change)="masterToggle()">

    </mat-checkbox>
  </ng-template>


  <ng-template #Id let-value="value" let-row="row">
    <div>
      <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null"
        [checked]="selection.isSelected(row)" [aria-label]="checkboxLabel(row)"></mat-checkbox>
    </div>
  </ng-template>
  <ng-template #TitleCell let-value="value" let-row="row">
    <div class="navigation-cell" (click)="clickItem(row)">
      {{ row?.Title }}
    </div>
  </ng-template>
  <ng-template #UpdatedDateCell let-prop="prop" let-row="row">


    {{row?.UpdatedDate + "Z"| timeAgo}}
  </ng-template>
  <ng-template #actionsTmpl let-row="row" let-prop="prop">
    <button *ngIf="row['_actions'] != null" mat-button [matMenuTriggerFor]="beforeMenu">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #beforeMenu="matMenu" xPosition="before">
      <button mat-menu-item *ngFor="let act of row['_actions']" (click)="action(row,act.ActionKey)">
        <mat-icon>{{act.Icon}}</mat-icon> {{act.Text}}
      </button>

    </mat-menu>
  </ng-template>

  <!-- Mobile -->
  <ng-container *ngIf="currentMediaQuery =='xs' || currentMediaQuery =='sm' ">

    <mat-accordion *ngIf="bindedData == true" class="accordion">
      <mat-expansion-panel [id]="item.Id" #expansionPanel (afterExpand)="scrollTo(content, item.Id, index)"
        *ngFor="let item of data; let odd = odd;let index = index;">
        <mat-expansion-panel-header (click)="expand(expansionPanel, $event)"
          [ngClass]="{'odd-item-list' : odd, 'item-list-expanded' : expansionPanel.expanded}">
          <mat-panel-title style="display: unset;">
            <ion-item lines="none">
              <ion-avatar slot="start" *ngIf="item.__avatar != null">
             </ion-avatar>
             <ion-checkbox *ngIf="this.selection.isEmpty() == false" [(ngModel)]="item.__isChecked"></ion-checkbox>
 
              <ion-label style="width: 100%">
                {{getPrimaryColumn(item)}}
              </ion-label>
            </ion-item>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="row-content" *ngFor="let prop of getColumnsForMobile(item)">
          <span class="label">{{prop.text}}</span>
          <span class="value">{{prop.value}}</span>
        </div>


        <!-- Acciones -->
        <div style="text-align: end;">
          <ion-button size="small">
            Abrir
          </ion-button>

        </div>

      </mat-expansion-panel>
    </mat-accordion>

    <!-- Infinite Scroll -->
    <ion-infinite-scroll #infiniteScroll (ionInfinite)="handleInfiniteScroll(infiniteScroll, $event)">
      <ion-infinite-scroll-content></ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </ng-container>


</ion-content>

<ion-footer *ngIf="currentMediaQuery =='xs' || currentMediaQuery =='sm' ">
  <ion-toolbar>
    <ion-button icon-start size="small" fill="clear" (click)="openMassiveActions()">
      <ion-icon name="ellipsis-vertical"></ion-icon> selecciona la acción
    </ion-button>

    <!-- <ion-button icon-start size="small">
      <ion-icon name="trash"></ion-icon> Eliminar
    </ion-button> -->

  </ion-toolbar>
</ion-footer>